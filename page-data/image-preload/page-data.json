{
    "componentChunkName": "component---src-templates-post-template-tsx",
    "path": "/image-preload/",
    "result": {"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>기본적인 이미지가 있고, 해당 이미지에 마우스를 hover할 시에 이미지가 변경이 되었어야했다.\n처음엔 그냥 hover시 css에서 background-url을 변경해주었다.\n그러자 배포서버에서 이미지가 깜빡이는 경우가 발생하였다.\n네트워크를 확인해보니, hover시에 status 200 Code로 이미지를 불러오는 것을 볼 수 있었다.\n그래서 이미지를 불러오는 시간 때문에 깜빡거림이 발생한 것이다.\n첫번째 hover 이후에는 캐싱이 되어서 깜빡거림이 없긴했지만, 처음 hover시가 심했다. 특히 느린 network에서는 엄청 심했다.</p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 521px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/60a7019ac79899680804e27902e0fac2/db56f/status-200.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.5625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+0lEQVQY04WQzUrDQBRG88R15Qu4UJ+kgiBF1OpexZVgV8YkkqZNMmlm8jcVGU0mpyRQwYV44MC3uve715HZmnQd8lHnDJnuE7BAB7TY7htVlKQiI05ShNggVYExhoG+70f32Zk9RsweQi6fYi7ul1w/F9wtNLcLzfylQTaGOI5583zew5DX1CURAmO+fg3c6xzfaE7nmqMrzcl8y+F5w2Rac3BWM5lWeMKg8owwWhEuI1bJGq23KFWwyeVPuz0O/2C7lmyTj+cmqUBKRaO31I0eXzFYVvVoVTc4ne35S9tDWVa4rksQBPh+gOd5tG1Lng9LEpRSY0tr7egOFCd2Z//AxU8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/60a7019ac79899680804e27902e0fac2/a59e9/status-200.webp 192w,\n/static/60a7019ac79899680804e27902e0fac2/0ca9f/status-200.webp 384w,\n/static/60a7019ac79899680804e27902e0fac2/222ae/status-200.webp 521w\"\n              sizes=\"(max-width: 521px) 100vw, 521px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/60a7019ac79899680804e27902e0fac2/3b721/status-200.png 192w,\n/static/60a7019ac79899680804e27902e0fac2/66595/status-200.png 384w,\n/static/60a7019ac79899680804e27902e0fac2/db56f/status-200.png 521w\"\n            sizes=\"(max-width: 521px) 100vw, 521px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/60a7019ac79899680804e27902e0fac2/db56f/status-200.png\"\n            alt=\"status 200\"\n            title=\"status 200\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>그래서 image preload를 사용해보기로 하였다.\nuseEffect 에서 hover할 시의 image를 미리 불러올 수 있게 작성하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>preloadImage<span class=\"token punctuation\">,</span> setPreloadImage<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLImageElement <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hoverImgSrc<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> image <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        image<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> hoverImgSrc<span class=\"token punctuation\">;</span>\n        <span class=\"token function\">setPreloadImage</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>hoverImgSrc<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이렇게 했을 시에 네트워크 탭을 살펴보니 304로 캐시된 이미지를 불러오는 것을 확인할 수 있었다.\n하지만, 캐시된 것일지라도 다시 불러오는 것이기 때문에 기존보다 빨리 불러오긴 하지만 조금의 깜빡거림이 발생하는 것을 막을 수는 없었다.</p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 521px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/60a7019ac79899680804e27902e0fac2/db56f/status-200.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.5625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+0lEQVQY04WQzUrDQBRG88R15Qu4UJ+kgiBF1OpexZVgV8YkkqZNMmlm8jcVGU0mpyRQwYV44MC3uve715HZmnQd8lHnDJnuE7BAB7TY7htVlKQiI05ShNggVYExhoG+70f32Zk9RsweQi6fYi7ul1w/F9wtNLcLzfylQTaGOI5583zew5DX1CURAmO+fg3c6xzfaE7nmqMrzcl8y+F5w2Rac3BWM5lWeMKg8owwWhEuI1bJGq23KFWwyeVPuz0O/2C7lmyTj+cmqUBKRaO31I0eXzFYVvVoVTc4ne35S9tDWVa4rksQBPh+gOd5tG1Lng9LEpRSY0tr7egOFCd2Z//AxU8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/60a7019ac79899680804e27902e0fac2/a59e9/status-200.webp 192w,\n/static/60a7019ac79899680804e27902e0fac2/0ca9f/status-200.webp 384w,\n/static/60a7019ac79899680804e27902e0fac2/222ae/status-200.webp 521w\"\n              sizes=\"(max-width: 521px) 100vw, 521px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/60a7019ac79899680804e27902e0fac2/3b721/status-200.png 192w,\n/static/60a7019ac79899680804e27902e0fac2/66595/status-200.png 384w,\n/static/60a7019ac79899680804e27902e0fac2/db56f/status-200.png 521w\"\n            sizes=\"(max-width: 521px) 100vw, 521px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/60a7019ac79899680804e27902e0fac2/db56f/status-200.png\"\n            alt=\"status 304\"\n            title=\"status 304\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>그래서 preload시에 만든 img 를 state에 저장해두고, 그 img의 src를 컴포넌트에서 사용하도록 수정하였다.\n그랬더니 네트워크 탭을 확인했을 때 처음에 요청한거를 그대로 사용하여, hover시에 304로 캐시된 이미지를 불러오는 요청이 없어졌다.\n처음 hover시에도 깜빡거리지 않고, 자연스러운 이미지 변경이 가능했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>preloadImage<span class=\"token punctuation\">,</span> setPreloadImage<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLImageElement <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hoverImgSrc<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> image <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        image<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> hoverImgSrc<span class=\"token punctuation\">;</span>\n        <span class=\"token function\">setPreloadImage</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>hoverImgSrc<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>확인시에 주의할 점은, 개발자 도구를 키고, disable cache를 해제해야, 유정입장에서 캐쉬가 잘 되는지를 확인할 수 있다. 그리고, 확인할 때마다 캐시 비우기 및 강력 새로고침을 해야 제대로 확인할 수 있을 것이다.</p>","frontmatter":{"title":"Image Preload로 이미지 깜빡임 해결하기","summary":"hover시 image가 바뀌어야하는데, image를 불러오는 시간 때문에 깜빡이는 현상이 있어서 preload를 사용해보았다.","date":"2022.05.08.","categories":["Web"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvUlEQVQoz62SWxLCIAxFu/+diFIfP45QW8fxUZcgSd3KdVqkDZ1W+fAjA7mTHHKBbGUZ/4xsLCwNRXuZ+6DJ2hmgBJBoDvoQoW4MzeLp5GQMZRiLAwnda8okT+iLtGWUdYPixqja9f6CvRJOjwbmQihrxq6iD5jSLG+O1DXtzw7rwkFb1+Xb0q/ahsm/Wh7uRfWWvVVpVxnuYeE6El5ZPgCLxlj/YXkM9k2t/dZqfFjiP5wC5gUht88BaOaBb71IjFMrgarRAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/175690a78044366d3800b2cdea7a0cf4/9b7d7/image-preload.png","srcSet":"/static/175690a78044366d3800b2cdea7a0cf4/5d231/image-preload.png 192w,\n/static/175690a78044366d3800b2cdea7a0cf4/e1116/image-preload.png 384w,\n/static/175690a78044366d3800b2cdea7a0cf4/9b7d7/image-preload.png 768w","sizes":"(min-width: 768px) 768px, 100vw"},"sources":[{"srcSet":"/static/175690a78044366d3800b2cdea7a0cf4/a3a09/image-preload.webp 192w,\n/static/175690a78044366d3800b2cdea7a0cf4/5358b/image-preload.webp 384w,\n/static/175690a78044366d3800b2cdea7a0cf4/81e8e/image-preload.webp 768w","type":"image/webp","sizes":"(min-width: 768px) 768px, 100vw"}]},"width":768,"height":402}},"publicURL":"/static/175690a78044366d3800b2cdea7a0cf4/image-preload.png"}}}}]}},"pageContext":{"slug":"/image-preload/"}},
    "staticQueryHashes": []}