{
    "componentChunkName": "component---src-templates-post-template-tsx",
    "path": "/custom-confirm/",
    "result": {"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>Custom Confirm을 구현할 일이 있었다. 기존에는 <code class=\"language-text\">window.confirm</code>을 사용하고 있었는데, 해당 부분에 style을 주길 원했다.\n기존 window.confirm에 style이 적용될리 만무했고, custom 한 confirm 기능을 구현해야했다.</p>\n<p>기능을 구현하기 위해서, <code class=\"language-text\">useConfirm.ts</code> 와 <code class=\"language-text\">Confirm.tsx</code> 를 구현했다. Confirm을 보이게 하고 말고의 값은 모든 영역에서 사용할 수 있게 redux를 활용하였는데 코드가 기니 생략한다. 알아서 다들 잘 사용할 것이라 생각한다.</p>\n<p><strong><em>useConfirm.ts</em></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useDispatch<span class=\"token punctuation\">,</span> useSelector <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-redux'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> actions<span class=\"token punctuation\">,</span> RootState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'~/modules'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">resolveCallback</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>value<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//useConfirm을 confirm을 쓴 곳과 다른 곳에서 사용해도 resolve 할 수 있다.</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useConfirm</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> confirmState <span class=\"token operator\">=</span> <span class=\"token function\">useSelector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>state<span class=\"token operator\">:</span> RootState<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> state<span class=\"token punctuation\">.</span>confirm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> dispatch <span class=\"token operator\">=</span> <span class=\"token function\">useDispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">confirm</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>text<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 여기서 text 활용하여 confirm 창이 열리게 코드 작성</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span>actions<span class=\"token punctuation\">.</span>confirm<span class=\"token punctuation\">.</span><span class=\"token function\">showConfirm</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> rej<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      resolveCallback <span class=\"token operator\">=</span> res<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">closeConfirm</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Confirm 창이 닫히게 작성</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span>actions<span class=\"token punctuation\">.</span>confirm<span class=\"token punctuation\">.</span><span class=\"token function\">hideConfirm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onConfirm</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">closeConfirm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    resolveCallback<span class=\"token operator\">?.</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onCancel</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">closeConfirm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    resolveCallback<span class=\"token operator\">?.</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> confirm<span class=\"token punctuation\">,</span> onConfirm<span class=\"token punctuation\">,</span> onCancel<span class=\"token punctuation\">,</span> confirmState <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong><em>Confirm.tsx</em></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Dialog <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'~/components'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2개의 버튼이 나오는 모달 컴포넌트</span>\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useConfirm <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'~/shared/hooks/useConfirm'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> ConfirmDialog<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">VFC</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> onConfirm<span class=\"token punctuation\">,</span> onCancel<span class=\"token punctuation\">,</span> confirmState <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useConfirm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Dialog</span></span>\n      <span class=\"token attr-name\">isShown</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>confirmState<span class=\"token punctuation\">.</span>isShow<span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">description</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>confirmState<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">descriptionPosition</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>center<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">onClose</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>onCancel<span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">onSuccess</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>onConfirm<span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">cancelText</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>취소<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">successText</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>확인<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token punctuation\">/></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>사용하는 곳에서는 이런 느낌으로 적어주었다.</p>\n<p><strong><em>Test.tsx</em></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// ~~</span>\n<span class=\"token comment\">// form이 바뀌었는지 안 바뀌었는지 확인하는 isDirty 변수 존재</span>\n<span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">useRouter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> confirm <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useConfirm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> routeValidateCheck <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//~~~</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">changeRouteAfterConfirm</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>url<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> confirmationMessage <span class=\"token operator\">=</span>\n      <span class=\"token string\">'저장되지 않은 내용이 있습니다. 페이지를 이탈 하시겠습니까?'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> isConfirm <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">confirm</span><span class=\"token punctuation\">(</span>confirmationMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isConfirm<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    routeValidateCheck<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    router<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">beforeRouteHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>url<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isDirty <span class=\"token operator\">||</span> routeValidateCheck<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    router<span class=\"token punctuation\">.</span>events<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'routeChangeError'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">changeRouteAfterConfirm</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Route Abort</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  router<span class=\"token punctuation\">.</span>events<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'routeChangeStart'</span><span class=\"token punctuation\">,</span> beforeRouteHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    router<span class=\"token punctuation\">.</span>events<span class=\"token punctuation\">.</span><span class=\"token function\">off</span><span class=\"token punctuation\">(</span><span class=\"token string\">'routeChangeStart'</span><span class=\"token punctuation\">,</span> beforeRouteHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>isDirty<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Nextjs 에는 route에 events를 등록할 수 있다. <a href=\"https://nextjs.org/docs/api-reference/next/router\" target=\"_blank\" rel=\"nofollow\">https://nextjs.org/docs/api-reference/next/router</a>\nrouteChangeStart 를 할 때, <code class=\"language-text\">beforeRouteHandler</code> 함수를 실행 시킨다. <code class=\"language-text\">isDirty</code>는 해당 form의 내용을 수정했는지 안 했는지의 여부이며, 수정을 하지 않았을 경우에는 그냥 router가 이동하게된다.\nbeforeRouteHandler의 callback 함수는 async 일 경우 제대로 동작하지 않았다. 그래서 <code class=\"language-text\">async changeRouteAfterConfirm</code> 함수를 만들어 실행시켜주었다. <code class=\"language-text\">routeChangeError</code> 이벤트 와 throw 를 던져주면 routeChange가 취소 된다.</p>\n<p><code class=\"language-text\">changeRouteAfterConfirm</code> 함수 안에서 confirm으로 확인 여부를 물은 후, true 일경우에 가고자 했던 곳으로 router.push를 한다. <code class=\"language-text\">routeValidateCheck.current = true</code> 를 하는 이유는\n하지 않을 경우 <code class=\"language-text\">router.push</code> 에서 또 걸려서 무한 반복하게 되기 때문이다.</p>\n<br/>\n<p>이렇게 해서 route가 변화하는 것을 막고, 유저가 확인을 눌렀을 경우 제대로 route하고, 취소일 경우에는 그대로 유지할 수 있게 하였다.</p>","frontmatter":{"title":"Next js에서 커스텀 confirm 만들기","summary":"커스텀 confirm을 만들어 보았던 경험을 남긴다. 뒤로가기 시에 custom한 confirm을 띄우고 확인시에 뒤로가게 구현하였다.","date":"2022.04.19.","categories":["Web"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1ElEQVQoz61SXROBQBTt//8OxTBChD60RRm8eJLoizT+xjG7RiqaGuPhzL333Ltn98xdbtg54p/gmgwN2m4hz9flGa584Fdkgq+ERlFw0ecPGUS+yL1yGhn4Z53XYC+kDXUcwFRjLPULHDOBbVxBlDjjdk6KtZWwnPJbO8V+d8dmdYMxi9gFb8uCC1k8gcwjWNqFiVCokwDaJIClxSBKhMU0ZFAkn/UdcmVisnhuaFn45Ap86/Ddct1SqjZbueW6QanrYdzzGv2GWkFqbT7yocthI8EH1qSAjTU4F9gAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/170f399f99dbed5dfef0c99ac209ae66/9b7d7/custom-confirm.png","srcSet":"/static/170f399f99dbed5dfef0c99ac209ae66/5d231/custom-confirm.png 192w,\n/static/170f399f99dbed5dfef0c99ac209ae66/e1116/custom-confirm.png 384w,\n/static/170f399f99dbed5dfef0c99ac209ae66/9b7d7/custom-confirm.png 768w","sizes":"(min-width: 768px) 768px, 100vw"},"sources":[{"srcSet":"/static/170f399f99dbed5dfef0c99ac209ae66/a3a09/custom-confirm.webp 192w,\n/static/170f399f99dbed5dfef0c99ac209ae66/5358b/custom-confirm.webp 384w,\n/static/170f399f99dbed5dfef0c99ac209ae66/81e8e/custom-confirm.webp 768w","type":"image/webp","sizes":"(min-width: 768px) 768px, 100vw"}]},"width":768,"height":402}},"publicURL":"/static/170f399f99dbed5dfef0c99ac209ae66/custom-confirm.png"}}}}]}},"pageContext":{"slug":"/custom-confirm/"}},
    "staticQueryHashes": []}